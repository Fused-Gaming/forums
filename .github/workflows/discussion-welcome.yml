name: Welcome New Discussion Authors

on:
  discussion:
    types: [created]

permissions:
  discussions: write

jobs:
  welcome:
    runs-on: ubuntu-latest
    steps:
      - name: Check if first-time author
        id: check
        uses: actions/github-script@v7
        with:
          script: |
            const author = context.payload.discussion.user.login;
            const { data: discussions } = await github.rest.search.discussions({
              q: `repo:${context.repo.owner}/${context.repo.repo} author:${author}`,
            });
            // If this is their only discussion, they're new
            return discussions.total_count <= 1;
          result-encoding: string

      - name: Welcome first-time author
        if: steps.check.outputs.result == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const category = context.payload.discussion.category.name;
            let welcomeMessage = `## ðŸ‘‹ Welcome to FUSED GAMING!

Thanks for starting your first discussion here, @${context.payload.discussion.user.login}!

**Quick links:**
- ðŸ“œ [Community Guidelines](../blob/main/CODE_OF_CONDUCT.md)
- ðŸ“– [Wiki & Documentation](../wiki)
- ðŸŽ® [Discord](https://discord.gg/fusedgaming)

`;
            
            if (category.includes('Q&A') || category.includes('Help')) {
              welcomeMessage += `**Tips for getting help faster:**
- Include relevant details (chain, wallet, transaction hash if applicable)
- Share what you've already tried
- Check if your question was already answered in past discussions

Our community members typically respond within 24 hours.`;
            } else if (category.includes('Ideas') || category.includes('Feedback')) {
              welcomeMessage += `**For feature requests:**
- Describe the problem you're trying to solve
- Explain how your idea would help
- Upvote similar ideas to help us prioritize

We review community feedback weekly!`;
            }

            await github.graphql(`
              mutation($discussionId: ID!, $body: String!) {
                addDiscussionComment(input: {discussionId: $discussionId, body: $body}) {
                  comment { id }
                }
              }
            `, {
              discussionId: context.payload.discussion.node_id,
              body: welcomeMessage
            });
