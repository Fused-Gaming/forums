name: Discussion Notifications

on:
  discussion:
    types: [created, answered]
  discussion_comment:
    types: [created]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Notify on high-priority discussions
        uses: actions/github-script@v7
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          script: |
            const discussion = context.payload.discussion;
            const category = discussion.category.name.toLowerCase();
            const webhookUrl = process.env.DISCORD_WEBHOOK;
            
            const notifyCategories = ['bug', 'investor', 'security'];
            const shouldNotify = notifyCategories.some(function(c) { return category.includes(c); });
            
            if (!shouldNotify || !webhookUrl) return;
            
            const description = (discussion.body || '').slice(0, 200) + '...';
            const embedColor = category.includes('bug') ? 0xd73a4a : 0x0075ca;
            
            const embed = {
              title: 'New Discussion: ' + discussion.title,
              url: discussion.html_url,
              description: description,
              color: embedColor,
              fields: [
                { name: 'Category', value: discussion.category.name, inline: true },
                { name: 'Author', value: '@' + discussion.user.login, inline: true }
              ],
              timestamp: new Date().toISOString()
            };

            await fetch(webhookUrl, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ embeds: [embed] })
            });
